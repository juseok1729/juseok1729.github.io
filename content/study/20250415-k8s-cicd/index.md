---
title: "[CKA] CI/CD"
date: 2025-04-15T11:18:52+09:00
draft: false
categories: [study]
tags: [k8s, concepts]
description: ""
slug: ""
series: ["cka"]
series_order: 12
authors:
  - P373R
---

## 1. DevOpsì™€ CI/CD
DevOpsëŠ” ê°œë°œ(Dev)ê³¼ ìš´ì˜(Ops)ì˜ í•©ì„±ì–´ë¡œ ê°œë°œê³¼ ìš´ì˜ì„ ë”°ë¡œ ë¶„ë¦¬í•˜ì§€ì•Šê³  ì—°ê²°ëœ í•˜ë‚˜ì˜ í° ì›Œí¬í”Œë¡œìš°ë¡œ ìƒê°í•˜ì—¬ ì§€ì†ì ìœ¼ë¡œ ì†Œí”„íŠ¸ì›¨ì–´ë¥¼ ê³ ë„í™”í•˜ëŠ” ë°©ë²•ë¡ ì„ ë§í•œë‹¤.  
`# SRE ì—”ì§€ë‹ˆì–´` `# í”Œë«í¼ ì—”ì§€ë‹ˆì–´` `# ë°ë¸Œì˜µìŠ¤ ì—”ì§€ë‹ˆì–´`
- **SRE ì—”ì§€ë‹ˆì–´**: ì¥ì• ëŒ€ì‘, ëª¨ë‹ˆí„°ë§, ìë™í™”ë¥¼ í†µí•´ ê°œë°œê³¼ ìš´ì˜ ì‚¬ì´ì˜ ë‹¤ë¦¬ì—­í• , ì¥ì•  ì¬ë°œë°©ì§€
- **í”Œë«í¼ ì—”ì§€ë‹ˆì–´**: ì¸í”„ë¼, CI/CD íŒŒì´í”„ë¼ì¸, ê°œë°œ í™˜ê²½ë“±ì˜ í”Œë«í¼ ì„œë¹„ìŠ¤ ì œê³µ, DX(ê°œë°œì ê²½í—˜)ì— ì´ˆì 
- **ë°ë¸Œì˜µìŠ¤ ì—”ì§€ë‹ˆì–´**: ê°œë°œ ìƒëª…ì£¼ê¸° ì „ë°˜ì˜ íš¨ìœ¨ì„± ì¦ëŒ€ê°€ ëª©í‘œ, CI/CD íŒŒì´í”„ë¼ì¸ êµ¬ì¶•ìœ¼ë¡œ ë¹ ë¥¸ ë°°í¬ í”¼ë“œë°± ë£¨í”„ ê°•í™”ê°€ ëª©í‘œ, ëª¨ë‹ˆí„°ë§, ë¡œê¹…, ì•Œë¦¼ ì‹œìŠ¤í…œ êµ¬ì¶•ì´ ê´€ì‹¬ì‚¬

**ë°ë¸Œì˜µìŠ¤ í”Œë¡œìš°**
1. Plan : ê°œë°œí•˜ê³ ì í•˜ëŠ” ì†Œí”„íŠ¸ì›¨ì–´ê°€ ë¬´ì—‡ì¸ì§€ ì •ì˜í•˜ê³  ìš”êµ¬ì‚¬í•­ë“¤ì„ ì •ë¦¬
2. Coding : ì½”ë“œë¥¼ ê°œë°œí•˜ê³  ë¦¬ë·°í•˜ë©° ì½”ë“œ ì €ì¥ì†Œì— ì½”ë“œë¥¼ ì €ì¥
3. Building : í…ìŠ¤íŠ¸ì¸ ì½”ë“œë¥¼ ì‹¤í–‰ ê°€ëŠ¥í•œ í˜•íƒœë¡œ ë¹Œë“œ
4. Testing : ì‹¤í–‰ íŒŒì¼ì„ í…ŒìŠ¤íŠ¸
5. Packaging : í…ŒìŠ¤íŠ¸ë¥¼ ê±°ì¹œ ê²°ê³¼ë¬¼ë“¤ì„ íŒ¨í‚¤ì§•í•˜ì—¬ ë°°í¬ ê°€ëŠ¥í•œ í˜•íƒœë¡œ ì €ì¥
6. Deploy : ì¶œì‹œëœ ì‚°ì¶œë¬¼ì„ ì‹¤ì œ í™˜ê²½ì— ë°°í¬
7. Operate : ë°°í¬ëœ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì •ìƒì ìœ¼ë¡œ ë™ì‘í•˜ë„ë¡ ê´€ë¦¬
8. Monitor : ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì„±ëŠ¥ ì¸¡ì •, ì‚¬ìš©ì„±ë“±ì„ ê´€ì¸¡

ìœ„ì˜ í”Œë¡œìš°ë¥¼ ìë™í™”í•˜ê³  ì§€ì†ì ìœ¼ë¡œ ì½”ë“œì˜ ë³€ê²½ì‚¬í•­ì„ ì ìš©í•´ ë¹ ë¥´ê²Œ ë³€í™”í•˜ëŠ” ìš”êµ¬ì‚¬í•­ì— ëŒ€ì‘í•˜ê³  ìƒì‚°ì„±ê³¼ ì•ˆì •ì„± ëª¨ë‘ë¥¼ ê¾€í•˜ëŠ” ê°œë°œ ë°©ë²•ë¡ ì´ë‹¤.    

### 1-1. CI/CDë€?
- CI : ë°˜ë³µì ì¸ ì½”ë“œ í†µí•©ì„ ìë™í™”í•˜ëŠ”ê²ƒ
- CD : ë°˜ë³µì ì¸ ì†Œí”„íŠ¸ì›¨ì–´ ë°°í¬ë¥¼ ìë™í™”í•˜ëŠ”ê²ƒ

### 1-2. CI(ì§€ì†ì  í†µí•©)
ê°œë°œìëŠ” í•˜ë£¨ì—ë„ ìˆ˜ì‹­ë²ˆ ìˆ˜ë°±ë²ˆì”© ì½”ë“œë¥¼ ìˆ˜ì •í•œë‹¤. ì´ê²ƒì„ git ì €ì¥ì†Œì— push í•˜ê³ , í…ŒìŠ¤íŠ¸í•˜ê³ , ë¹Œë“œí•˜ì—¬ ë°°í¬ë¥¼ ì¤€ë¹„í•œë‹¤.  
ì´ê³¼ì •ì„ ìë™í™”í•´ ê°œë°œìë“¤ì´ ì½”ë“œ ê°œë°œì—ë§Œ ì§‘ì¤‘í•  ìˆ˜ ìˆê²Œ í•œë‹¤.  

### 1-3. CD(ì§€ì†ì  ë°°í¬)
CDëŠ” íŒ¨í‚¤ì§•ê³¼ ë°°í¬ë¥¼ ìë™í™”í•˜ëŠ”ê²ƒì„ ë§í•œë‹¤. ìë™ìœ¼ë¡œ ì†Œí”„íŠ¸ì›¨ì–´ë¥¼ íŒ¨í‚¤ì§•í•˜ê³  ìš´ì˜ í™˜ê²½ì— ë°°í¬í•œë‹¤.  
ë°°í¬ì‹œ ë°œìƒí•  ìˆ˜ ìˆëŠ” ë¬¸ì œë¥¼ ë¹ ë¥´ê²Œ ì¸ì§€í•˜ê³  ë¡¤ë°±í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì„ ì œê³µí•œë‹¤. ë³€ê²½ì ì„ ì•ˆì „í•˜ê³  ë¹ ë¥´ê²Œ ë°°í¬í•  ìˆ˜ ìˆê²Œ í•œë‹¤.  

### 1-4. ì¥ì 
**ë¹ ë¥¸ ì œí’ˆ ë°˜ì˜**  
ê°œë°œì˜ ìµœì¢…ëª©ì ì€ ì†Œí”„íŠ¸ì›¨ì–´ë¥¼ í†µí•´ ë¹„ì¦ˆë‹ˆìŠ¤ì  ê°€ì¹˜ë¥¼ ì°½ì¶œí•˜ëŠ”ê²ƒì¸ë°, ë¹„ì¦ˆë‹ˆìŠ¤ ìš”êµ¬ì‚¬í•­ì˜ ë³€í™”ì— ë”°ë¼ ì†Œí”„íŠ¸ì›¨ì–´ë¥¼ ë¹ ë¥´ê²Œ ë¦´ë¦¬ì¦ˆí•˜ì—¬ ì‚¬ìš©ìì˜ ìš”êµ¬ì‚¬í•­ì„ ì‹ ì†í•˜ê²Œ ì œí’ˆì— ë°˜ì˜í•  ìˆ˜ ìˆë‹¤.  

**ìš´ì˜ ì•ˆì •ì„± í™•ë³´**  
ìë™í™”ë¥¼ í†µí•´ íœ´ë¨¼ì—ëŸ¬ë¥¼ ìµœì†Œí™” í•  ìˆ˜ ìˆë‹¤.  
ì´ë¥¼ í†µí•´ ê°œë°œ/ìš´ì˜ í™˜ê²½ì—ì„œì˜ ì¥ì• ë¥¼ ìµœì†Œí™”í•˜ê³  ë†’ì€ ì•ˆì •ì„±ì„ í™•ë³´í•  ìˆ˜ ìˆë‹¤.  

**ë¹ ë¥¸ í”¼ë“œë°±**  
CIì™€ CDë¥¼ í†µí•´ ë¬¸ì œì ì„ ë¹ ë¥´ê²Œ ë°œê²¬í•´ ì‹ ì†íˆ ë²„ê·¸ë¥¼ ìˆ˜ì •í•´ ë†’ì€ í’ˆì§ˆì˜ ì†Œí”„íŠ¸ì›¨ì–´ë¥¼ ì œê³µí•  ìˆ˜ ìˆë‹¤.  

**í’ˆì§ˆ í–¥ìƒ**  
ë¹ ë¥¸ í”¼ë“œë°±ê³¼ ì¦ì€ ë°°í¬ë¥¼ í†µí•´ ì†Œí”„íŠ¸ì›¨ì–´ì˜ í’ˆì§ˆì„ ìì—°ìŠ¤ëŸ½ê²Œ í–ìƒì‹œí‚¬ ìˆ˜ ìˆë‹¤.  

**í˜‘ë ¥ì„± ì¦ëŒ€**  
ê°œë°œìë¡œ í•˜ì—¬ê¸ˆ ì†Œí”„íŠ¸ì›¨ì–´ë¥¼ ìˆ˜ì •í•˜ëŠ” ë¶€ë‹´ì„ ì¤„ì¸ë‹¤.  
ë°˜ë³µì  ë…¸ê°€ë‹¤ ì‘ì—…ì„ CI/CD íˆ´ì—ê²Œ ìœ„ì„í•´ í˜‘ì—…í•˜ê¸° í¸í•œ í™˜ê²½ì„ ë§Œë“ ë‹¤.  
CI/CD ê³¼ì • ì¤‘ì— ë°œìƒí•˜ëŠ” ì»¤ë®¤ë‹ˆì¼€ì´ì…˜ ë¹„ìš©ì„ ì¤„ì—¬ ë³´ë‹¤ ì¤‘ìš”í•œ ì¼ì— ì§‘ì¤‘í•  ìˆ˜ ìˆê²Œ ë§Œë“¤ì–´ ì¤€ë‹¤.  


## 2. CI íŒŒì´í”„ë¼ì¸
### 2-1. ì  í‚¨ìŠ¤(Jenkins)
ì  í‚¨ìŠ¤ëŠ” ì¸ê¸°ìˆëŠ” ëŒ€í‘œì ì¸ ì˜¤í”ˆì†ŒìŠ¤ CI/CD íˆ´ì´ë‹¤.  
ë§ˆì°¬ê°€ì§€ë¡œ helm chartë¡œ ì†ì‰½ê²Œ êµ¬ì„±ì´ ê°€ëŠ¥í•˜ë‹¤.  
```bash
# ì  í‚¨ìŠ¤ ì°¨íŠ¸ ë‹¤ìš´ë¡œë“œ
h fetch --untar stable/jenkins --version 2.3.0

# ì  í‚¨ìŠ¤ ì„¤ì •íŒŒì¼ ìˆ˜ì •
vi jenkins/values.yaml
```

ì  í‚¨ìŠ¤ Ingressë¥¼ ì„¤ì •í•œë‹¤.  
```yaml
ingress:
  enable: true
  annotations:
    kubernetes.io/ingress.class: nginx
  hostName: jenkins.10.0.1.1.sslip.io
```

ì  í‚¨ìŠ¤ë¥¼ ë°°í¬í•œë‹¤.
```bash
h install jenkins ./jenkins
```

`watch` ë¡œ íŒŒë“œì˜ ìƒíƒœë¥¼ í™•ì¸í•´ **READY**ê°€ ë ë•Œê¹Œì§€ ê¸°ë‹¤ë¦°ë‹¤.  
ë˜ëŠ” íŠ¹ì • ìƒíƒœë¥¼ ì¡°ê±´ê±¸ì–´ í™•ì¸í•  ìˆ˜ë„ ìˆë‹¤.
```bash
# ìƒíƒœ í™•ì¸ ë°©ë²• 1
watch kubectl get po

# ìƒíƒœ í™•ì¸ ë°©ë²• 2
k wait --forcondition=Ready pod jenkins-xxx-xxx
```

ì„¤ì¹˜(ë°°í¬)ê°€ ì™„ë£Œ(READY) ë˜ì—ˆë‹¤ë©´, ê³„ì •ì •ë³´ëŠ” ì•„ë˜ ëª…ë ¹ì–´ë¡œ í™•ì¸ì´ ê°€ëŠ¥í•˜ë‹¤.  
```bash
# usernameì€ admin ì´ë‹¤.
printf $(kubectl get secret --namespace default jenkins -o jsonpath="{.data.jenkins-admin-password}" | base64 --decode);echo
```

ì  í‚¨ìŠ¤ ì ‘ì†ì„ ì„±ê³µí–ˆë‹¤ë©´, ë°”ë¡œ ë‹¤ìŒê³¼ ê°™ì€ Jobì„ ìƒì„±í•˜ê³  ì‹¤í–‰í•œë‹¤.  
1. New item > Free style project > Enter an item name: myfirstjob > OK
2. Build > Add build step > Execute shell
3. Command > echo "hello world!" ì…ë ¥ > Save
4. Build Now > #1 > Console Output

```bash
watch kubectl get po
```
ë°©ê¸ˆ ì‹¤í–‰í•œ ë¹Œë“œ ì¡ì´ ì‹¤í–‰ë˜ë©´ì„œ íŒŒë“œê°€ í•œê°œ ìƒì„±ë˜ì—ˆë‹¤ê°€ ì‚¬ë¼ì§€ëŠ”ê²ƒì„ ëª©ê²©í•  ìˆ˜ ìˆë‹¤.  
ì¿ ë²„ë„¤í‹°ìŠ¤ë¥¼ í†µí•´ ë°°í¬ëœ ì  í‚¨ìŠ¤ ì›Œì»¤ëŠ” Dynamic Worker ë¡œì¨ í•„ìš”ì— ë”°ë¼ì„œ ìƒì„±/ì‚­ì œë˜ì–´ ë¦¬ì†ŒìŠ¤ë¥¼ ì§€ì†ì ìœ¼ë¡œ ì ìœ í•˜ì§€ ì•ŠëŠ”ë‹¤.  

**Dynamic workerì˜ ì¥ì **
- í™•ì¥ì„± : ë¬¼ë¦¬ë…¸ë“œê°€ ê³ ì •ëœê²Œ ì•„ë‹ˆë¼ Podë¡œ ë™ì‘í•˜ê¸° ë•Œë¬¸ì— ì‘ì—…ë¶€í•˜ê°€ ì»¤ì§€ë©´ Podì˜ ê°œìˆ˜ë§Œ ëŠ˜ë¦¬ë©´ ëœë‹¤. 
- ë¦¬ì†ŒìŠ¤ íš¨ìœ¨ : ì§€ì •ëœ ë…¸ë“œê°€ ì•„ë‹ˆê¸° ë•Œë¬¸ì— ë¹Œë“œì‘ì—…ì´ ì—†ì„ë•ŒëŠ” ë™ì¼í•œ ë…¸ë“œì— ë‹¤ë¥¸ Podë¥¼ ì‹¤í–‰ì‹œí‚¬ ìˆ˜ ìˆë‹¤.  
- ê´€ë¦¬ ìš©ì´ : ì  í‚¨ìŠ¤ í´ëŸ¬ìŠ¤í„°ë¥¼ ë”°ë¡œ ëª¨ë‹ˆí„°ë§ í•  í•„ìš” ì—†ì´ ì¿ ë²„ë„¤í‹°ìŠ¤ì—ê²Œ ì „ì ìœ¼ë¡œ ë§¡ê¸¸ ìˆ˜ ìˆë‹¤.  
- ë¹„ìš© : ë¬¼ë¦¬ì ì¸ ë…¸ë“œë¥¼ ê³ ì • ì ìœ í•˜ëŠ”ê²ƒì´ ì•„ë‹ˆë¼ì„œ ë¹„ìš©íš¨ìš¸ì´ ë†’ë‹¤.  

**Dynamic workerì˜ ë‹¨ì **
- ë…¸ë“œ ì½œë“œ ìŠ¤íƒ€íŠ¸ : ë¬¼ë¦¬ì  ë…¸ë“œê°€ ì•„ë‹ˆë”ë¼ë„ í•„ìš”í• ë•Œë§ˆë‹¤ Pod(ê°€ìƒ ë…¸ë“œ)ë¥¼ ìƒì„±í•´ì•¼í•˜ê¸° ë•Œë¬¸ì— ê·¸ ë§Œí¼ì˜ ì§€ì—°ì‹œê°„ì´ ë°œìƒí•œë‹¤.  
- ì•„í‹°íŒ©íŠ¸ íœ˜ë°œ : ì›Œì»¤ì—ì„œ ìƒì„±ëœ ê²°ê³¼(artifact)ê°€ ì¡ì´ ì¢…ë£Œë˜ë©´ ê°™ì´ ì‚­ì œë˜ê¸° ë•Œë¬¸ì— ë³„ë„ ì¤‘ì•™ ì €ì¥ì†Œì— ì €ì¥í•´ì•¼í•œë‹¤. (PVC)
- ì–´ë ¤ìš´ ë””ë²„ê¹… : Podê°€ ì‚­ì œë˜ ë¡œê·¸ê¸°ë¡ë„ ê°™ì´ ì‚¬ë¼ì ¸ ë””ë²„ê¹…ì´ ì–´ë ¤ìš¸ ìˆ˜ ìˆë‹¤.  

Dynamic Workerì˜ ë‹¨ì ì„ ë³´ì™„í•˜ê¸° ìœ„í•´ ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„° ìœ„ì—ì„œ ê°€ìƒë…¸ë“œ(Pod)ë¥¼ ê³ ì •ì‹œì¼œ ì  í‚¨ìŠ¤ í´ëŸ¬ìŠ¤í„°ë¥¼ ìš´ìš©í•  ìˆ˜ë„ ìˆë‹¤.  

**ê°€ìƒë…¸ë“œ(worker)ë¥¼ ê³ ì •í•˜ëŠ” ê²½ìš°**
- ë¦¬ì†ŒìŠ¤ ìš”êµ¬ì‚¬í•­ : íŠ¹ì • ë¹Œë“œ ì‘ì—…ì´ ë§ì€ ë©”ëª¨ë¦¬ë‚˜ CPUë¥¼ í•„ìš”ë¡œ í•˜ëŠ” ê²½ìš°, í•´ë‹¹ ë¦¬ì†ŒìŠ¤ê°€ ì¶©ë¶„í•œ íŠ¹ì • ë…¸ë“œì— ì›Œì»¤ë¥¼ ê³ ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- íŠ¹ìˆ˜ í•˜ë“œì›¨ì–´ í™œìš© : GPUë‚˜ íŠ¹ìˆ˜ ìŠ¤í† ë¦¬ì§€ê°€ í•„ìš”í•œ ë¹Œë“œ ì‘ì—…ì€ í•´ë‹¹ í•˜ë“œì›¨ì–´ê°€ ìˆëŠ” ë…¸ë“œì— ì›Œì»¤ë¥¼ ê³ ì •í•´ì•¼ í•©ë‹ˆë‹¤.
- ì„±ëŠ¥ ì¼ê´€ì„± : Dynamic WorkerëŠ” ë§¤ë²ˆ ë‹¤ë¥¸ ë…¸ë“œì— ìŠ¤ì¼€ì¤„ë§ë  ìˆ˜ ìˆì–´ ì„±ëŠ¥ í¸ì°¨ê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê³ ì •ëœ ì›Œì»¤ëŠ” ì¼ê´€ëœ ì„±ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.
- ìºì‹œ í™œìš© : ë¹Œë“œ ìºì‹œ, ì˜ì¡´ì„± ìºì‹œ ë“±ì´ ë¡œì»¬ì— ì €ì¥ë˜ì–´ ìˆì„ ë•Œ, ê°™ì€ ë…¸ë“œì—ì„œ ì‹¤í–‰ë˜ë©´ ìºì‹œ í™œìš©ë„ê°€ ë†’ì•„ì ¸ ë¹Œë“œ ì†ë„ê°€ í–¥ìƒë©ë‹ˆë‹¤.
- ë„¤íŠ¸ì›Œí¬ íš¨ìœ¨ì„± : íŠ¹ì • ë„¤íŠ¸ì›Œí¬ êµ¬ì„±ì´ë‚˜ ì„œë¹„ìŠ¤ì— ê°€ê¹Œìš´ ë…¸ë“œì— ì›Œì»¤ë¥¼ ë°°ì¹˜í•˜ë©´ ë„¤íŠ¸ì›Œí¬ ì§€ì—° ì‹œê°„ì„ ì¤„ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- ë³´ì•ˆ ìš”êµ¬ì‚¬í•­ : íŠ¹ì • ë³´ì•ˆ êµ¬ì„±ì´ë‚˜ ê²©ë¦¬ê°€ í•„ìš”í•œ ë¹Œë“œ ì‘ì—…ì€ í•´ë‹¹ ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” ë…¸ë“œì— ê³ ì •ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- ì•ˆì •ì„± : Dynamic WorkerëŠ” ì–¸ì œë“  ì¢…ë£Œë˜ê³  ìƒˆë¡œ ìƒì„±ë  ìˆ˜ ìˆì–´ ì¥ê¸° ì‹¤í–‰ ì‘ì—…ì— ë¶ˆì•ˆì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê³ ì •ëœ ì›Œì»¤ëŠ” ë” ì•ˆì •ì ìœ¼ë¡œ ìœ ì§€ë©ë‹ˆë‹¤.

### 2-2. CI íŒŒì´í”„ë¼ì¸
```bash
checkout -> build -> test -> push
```

ì´ê²ƒì„ ì½”ë“œë¡œ ì‘ì„±í•˜ë©´ ë‹¤ìŒê³¼ ê°™ë‹¤.  
```bash
# checkout
git clone $PROJECT
git checkout $BRANCH

# build
docker build . -t $USERNAME/$PROJECT

# test
docker run --entrypoint /test $USERNAME/$PROJECT

# push
docker login --username $USERNAME --password $PASSWORD
docker push $USERNAME/$PROJECT
```

### 2-3. DinD
ì  í‚¨ìŠ¤ê°€ ì»¨í…Œì´ë„ˆë¡œ êµ¬ë™ë˜ê³  ì  í‚¨ìŠ¤ ì•ˆì—ì„œ ë„ì»¤ ì´ë¯¸ì§€ë¥¼ í˜¸ìŠ¤íŠ¸ì— ìƒì„±í•´ì•¼ í•˜ê¸° ë•Œë¬¸ì— ê²°ê³¼ì ìœ¼ë¡œ ë„ì»¤ì•ˆì—ì„œ ë„ì»¤ë¥¼ ì‚¬ìš©í•˜ëŠ” ëª¨ì–‘ì´ ëœë‹¤.  
ë„ì»¤ì•ˆì—ì„œ ë„ì»¤ë¥¼ ì‹¤í–‰ì‹œí‚¤ëŠ” ë°©ë²•ì€ í¬ê²Œ ì•„ë˜ ë‘ê°€ì§€ê°€ ìˆë‹¤.  
ë³´í†µ ë‘ë²ˆì§¸ ë°©ë²•ì„ ì‚¬ìš©í•˜ê³ , ì²«ë²ˆì§¸ ë°©ë²•ì€ ë¬¸ì œê°€ ë°œìƒí•  ì†Œì§€ê°€ ìˆìœ¼ë¯€ë¡œ ì§€ì–‘í•œë‹¤.  
ê·¸ ì´ìœ ëŠ” í•´ë‹¹ í¬ìŠ¤íŒ…ì„ ì°¸ê³ í•˜ê¸¸ ë°”ë€ë‹¤. ğŸ‘‰ [ì»¨í…Œì´ë„ˆ ë³´ì•ˆ : DinD vs DooD](https://p373r.net/study/20250424-dind-vs-dood/)
1. ì»¨í…Œì´ë„ˆ ì•ˆì— ë„ì»¤ ë°ëª¬ì„œë²„ë¥¼ ë‚´ì¥ì‹œí‚¤ëŠ” ë°©ë²•
2. ì»¨í…Œì´ë„ˆ ì•ˆì—ì„œ í˜¸ìŠ¤íŠ¸ì˜ ë„ì»¤ ì„œë²„ë¥¼ ì°¸ì¡°í•˜ëŠ” ë°©ë²• -> (ì´ê±´ ì—„ë°€íˆ ë”°ì§€ìë©´ DooD)

  ```bash
  # docker socketì„ ë³¼ë¥¨ìœ¼ë¡œ ë°”ì¸ë”©í•˜ì—¬ ì°¸ì¡°í•˜ëŠ” ë°©ë²•
  docker run --rm -it -v /var/run/docker.sock:/var/run/docker.sock docker
  ```

jenkinsì˜ CI íŒŒì´í”„ë¼ì¸ì€ groovyë¼ëŠ” ì–¸ì–´ì˜ jenkinsfileë¡œ ì •ì˜ë˜ëŠ”ë° ê°„ëµí•˜ê²Œ ìš”ì•½í•˜ë©´ ì•„ë˜ ë™ì‘ì„ ìˆ˜í–‰í•œë‹¤.  
```yaml
checkout:
  command: <
    bash -c "
    git clone \$PROJECT_URL"

build:
  command: <
    bash -c "
    cd \$PROJECT_NAME/pipeline-sample
    docker build -t \$PROJECT_NAME . "

test:
  command: <
    bash -c "
    docker run --entrypoint /test \$PROJECT_NAME"

push:
  command: <
    bash -c "
    docker login -u ${DOCKER_HUB_USER} -p ${DOCKER_HUB_PASSWORD}"
    docker tag \$PROJECT_NAME ${DOCKER_HUB_USER}/\$PROJECT_NAME
    docker push ${DOCKER_HUB_USER}/\$PROJECT_NAME"
```
ìš”ì•½í•˜ë©´,
- checkout : $PROJECT_URL í™˜ê²½ë³€ìˆ˜ì— ê¹ƒ ë¦¬íŒŒì§€í† ë¦¬ë¥¼ checkout í•œë‹¤.  
- build : í•´ë‹¹ ë¦¬íŒŒì§€í† ë¦¬ì˜ ë„ì»¤ ì´ë¯¸ì§€ë¥¼ ìƒì„±í•œë‹¤.  
- test : ìƒì„±ëœ ì´ë¯¸ì§€ë¥¼ /test ë¼ëŠ” ëª…ë ¹ìœ¼ë¡œ í…ŒìŠ¤íŠ¸í•œë‹¤.  
- push : í…ŒìŠ¤íŠ¸ê°€ ì™„ë£Œëœ ì´ë¯¸ì§€ë¥¼ ë„ì»¤ í—ˆë¸Œì— ì—…ë¡œë“œí•œë‹¤.  

íŒŒì´í”„ë¼ì¸ ì™„ë£Œ í›„ ë¹Œë“œëœ ì´ë¯¸ì§€ê°€ ë„ì»¤í—ˆë¸Œì— ìƒì„±ëœê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.  


## 3. GitOpsë¥¼ ì´ìš©í•œ CD
### 3-1. GitOpsë€?

### 3-2. SSOT(ë‹¨ì¼ ì§„ì‹¤ì˜ ì›ì²œ)
í•˜ë‚˜ì˜ ì†ŒìŠ¤ë¡œ í†µí•©ë˜ì–´ ë°°í¬ê¹Œì§€ í˜ëŸ¬ê°€ëŠëƒ, ê°ì ë¡œì»¬ì—ì„œ ê°ê¸° ë‹¤ë¥¸ ë¡œì»¬ ë¸Œëœì¹˜ë¡œ ê°ê¸° ë°°í¬í•˜ëŠëƒì˜ ì°¨ì´.
git ì €ì¥ì†Œë¥¼ ë‹¨ì¼ ì§„ì‹¤ì˜ ì›ì²œìœ¼ë¡œ í™œìš©í•´ í˜‘ì—…í•˜ëŠ”ê²ƒì„ GitOpsë¼ í•œë‹¤.  

### 3-3. GitOpsì˜ ì›ì¹™
1. ì„ ì–¸í˜• ë°°í¬ ì‘ì—… ì •ì˜ì„œ(YAML)
2. gitì„ ì´ìš©í•œ ë°°í¬ ë²„ì „ ê´€ë¦¬
3. ë³€ê²½ ì‚¬í•­ ìš´ì˜ ë°˜ì˜ ìë™í™”
4. ì´ìƒ íƒì§€ ë° ìê°€ ì¹˜ìœ 


### 3-4. FluxCD
GitOps êµ¬í˜„ì²´ ì¤‘ í•˜ë‚˜ì´ë‹¤.  
helm chart ë¡œ ì†ì‰½ê²Œ êµ¬ì„±í•´ë³¼ ìˆ˜ ìˆë‹¤.
```bash
# flux repo ì¶”ê°€
h repo add fluxcd https://charts.fluxcd.io

# repo ì—…ë°ì´íŠ¸
h repo update

# crd ìƒì„±
k apply -f https://raw.githubusercontent.com/fluxcd/helm-operator/master/deploy/crds.yaml

# ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ìƒì„±
k create ns flux

# fluxcd ì°¨íŠ¸ ë°°í¬
h install get-started fluxcd/flux \
  --version 1.4.0 \
  --set git.url=https://github.com/core_kuberenetes.git \
  --set git.readonly=true \
  --set git.path=gitops \
  --namespace flux
```
- `git.url` : ì†ŒìŠ¤ repo (SSOT)
- `git.readonly` : git pull ë§Œ ìˆ˜í–‰í•˜ê² ë‹¤. ë¼ëŠ” ëœ»
- `git.path` : git repoì˜ íŠ¹ì • ë””ë ‰í† ë¦¬ ì•„ë˜ë§Œ ì°¸ì¡°í•˜ê² ë‹¤ëŠ” ëœ»

fluxcd ì°¨íŠ¸ ë°°í¬ê°€ ì™„ë£Œë˜ë©´ ê°œë°œìê°€ ì§ì ‘ ë°°í¬ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‘ì„±í•˜ì§€ ì•Šì•„ë„ fluxcdê°€ ì†ŒìŠ¤ë³€ê²½ì ì„ ê°ì§€í•´ ì†ŒìŠ¤(git.url)ë¥¼ ì°¸ì¡°í•˜ì—¬ ëŒ€ì‹  ë°°í¬í•´ì¤€ë‹¤.  

### 3-5. ArgoCD
GitOps êµ¬í˜„ì²´ ì¤‘ í•˜ë‚˜ì´ë‹¤.  
fluxcd ì™€ëŠ” ë‹¤ë¥´ê²Œ ì›¹ UIë¥¼ ì§€ì›í•´ ì›¹ ì¸í„°í˜ì´ìŠ¤ë¥¼ í†µí•´ ì¿ ë²„ë„¤í‹°ìŠ¤ ë¦¬ì†ŒìŠ¤ë¥¼ ë°°í¬í•  ìˆ˜ ìˆë‹¤.  
fluxcdëŠ” git repoë§ˆë‹¤ ì„¸íŒ…í•´ì¤˜ì•¼ í•˜ëŠ”ë° ArgoCDëŠ” í•˜ë‚˜ ì„¤ì¹˜í•˜ë©´ ì—¬ëŸ¬ git repoë¥¼ ì—°ê²°í•´ ë°°í¬ì‹œìŠ¤í…œì„ êµ¬ì¶•í•  ìˆ˜ ìˆë‹¤.  

Dive to Argo : https://dive-argo.haulrest.me

## 4. ë¡œì»¬ ì¿ ë²„ë„¤í‹°ìŠ¤ ê°œë°œ
### 4-1. skaffold
skaffoldëŠ” ê°€ë³ê³  ì‚¬ìš©í•˜ê¸° ê°„ë‹¨í•œ íˆ´ì´ì§€ë§Œ ê¸°ëŠ¥ì€ ê·¸ë ‡ì§€ì•Šì€? ë‚­ë‚­í•œ íˆ´ì´ë‹¤.  
ì½”ë“œ ìˆ˜ì •ì‹œ ì´ë¯¸ì§€ ë¹Œë“œ, ì´ë¯¸ì§€ ì—…ë¡œë“œ, Pod êµì²´, ë¡œê¹…ê¹Œì§€ ìë™ìœ¼ë¡œ ëŒ€ì‹  í•´ì£¼ëŠ” íˆ´ì´ë‹¤. 
```bash
# skaffold ë°”ì´ë„ˆë¦¬ ì„¤ì¹˜
curl -Lo skaffold https://storage.googleapis.com/skaffold/releases/latest/skaffold-linux-amd64
sudo install skaffold /usr/local/bin/
```

### 4-2. skaffold ì„¸íŒ…
```bash
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ pod.yaml
â””â”€â”€ app.py
```

```bash
# ì´ë¯¸ì§€ë¡œ ë°°í¬ë˜ê¸° ì „ì— ë„ì»¤ í—ˆë¸Œì— ë¡œê·¸ì¸ ë˜ì–´ìˆì–´ì•¼ í•œë‹¤.
docker login

# ê°œë°œ ë””ë ‰í† ë¦¬ ì•ˆì—ì„œ ì‹¤í–‰
skaffold init
```

### 4-3. skaffold ë°°í¬
ì•„ë˜ ëª…ë ¹ì–´ ì‹¤í–‰ ì‹œ ìë™ìœ¼ë¡œ ì´ë¯¸ì§€ ë¹Œë“œ, ë„ì»¤í—ˆë¸Œì— í‘¸ì‹œ, í´ëŸ¬ìŠ¤í„°ì— ë°°í¬ê¹Œì§€ ìë™ìœ¼ë¡œ ìˆ˜í–‰í•œë‹¤.  
```bash
skaffold run
```

ì•„ë˜ ëª…ë ¹ì–´ë§Œ ì…ë ¥í•˜ë©´ logging ê¹Œì§€ ìë™ìœ¼ë¡œ ì—°ê²°í•´ì¤€ë‹¤.  
```bash
skaffold run --tail
```

ë§ˆì§€ë§‰ìœ¼ë¡œ `skaffold dev` ë¥¼ ì‹¤í–‰í•˜ë©´ `skaffold run` ê³¼ ë™ì¼í•˜ì§€ë§Œ ì†ŒìŠ¤ì½”ë“œë‚˜ ë„ì»¤íŒŒì¼ì„ ìˆ˜ì •í•˜ë©´ ë³€ê²½ ì‚¬í•­ì„ ì¸ì§€í•˜ê³  ìë™ìœ¼ë¡œ ë‹¤ì‹œ ë¹Œë“œë¶€í„° ë°°í¬ê¹Œì§€ ìˆ˜í–‰í•˜ëŠ” í•« ë¦¬ë¡œë“œ ê¸°ëŠ¥ì´ í™œì„±í™”ëœë‹¤.  